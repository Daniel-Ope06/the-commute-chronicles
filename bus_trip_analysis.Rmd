---
title: "The Commute Chronicles"
subtitle: "An Analysis of Travel Efficiency, Weather Impacts, and Crowding"
author: "Opeoluwa Daniel Oyedeji"
date: "December 5, 2025"
output:
  bookdown::pdf_document2:
    toc: true
    toc_depth: 3
    number_sections: true
    highlight: pygments
    df_print: kable
    extra_dependencies: ["float"]
fontsize: 11pt
geometry: margin=1in
urlcolor: blue
header-includes:
  - \usepackage[font=small,labelfont=bf]{caption}
  - \usepackage[default]{lato}
  - \usepackage[scale=0.9]{sourcecodepro}
  - \usepackage[T1]{fontenc}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.pos="H", fig.showtext = TRUE, out.extra="", dev="cairo_pdf")
```

# Introduction

# Methods and Results

## Exploratory Data Analysis

### Dataset Overview

```{r loadData}
bus_data <- read.csv("bus_trip_data.csv")
bus_data$date <- as.Date(bus_data$date) # Convert date column to R Date type
```

The data has `r ncol(bus_data)` columns and `r nrow(bus_data)` rows. To ensure the table fits within the document margins, the data set is displayed below in two parts: the "To Campus" details and the "To Home" details.

```{r display-table-1, echo=FALSE}
df_display_1 <- bus_data[ , 1:5]
knitr::kable(head(df_display_1, 2), booktabs = TRUE)
```

```{r display-table-2, echo=FALSE}
df_display_2 <- bus_data[ , 6:10]
knitr::kable(head(df_display_2, 2), booktabs = TRUE)
```


```{r delete-display-variables, include=FALSE}
# Remove them to keep the environment clean
rm(df_display_1, df_display_2)
```

### Visual Inspection of Trends

Before running any complex statistical tests, we visualize the raw data to understand its shape. We are looking for two things: the **distribution** of the data (e.g. is it bell-shaped?) and any **trends** over time (e.g. is traffic getting worse?).

```{r histogram-side, echo=FALSE, fig.show="hold", out.width="50%", fig.cap="Histograms displaying the distribution of travel times for trips to campus (left) and trips to home (right) with 10-minute bin intervals."}
par(mar = c(4, 4, 1, .1))

hist(bus_data$dur_to_campus, 
     main = "Distribution of Commute Duration to Campus",
     xlab = "Duration (Minutes)", 
     col = "lightblue", 
     border = "white",
     breaks = 10)

hist(bus_data$dur_to_home,
     main = "Distribution of Commute Duration to Home",
     xlab = "Duration (Minutes)",
     ylab = "", # No Y label needed on 2nd plot
     col = "salmon", 
     border = "white",
     breaks = 10)
```

An examination of the distributional shape (Figure \@ref(fig:histogram-side)) highlights the following patterns:

- Both histograms exhibit a *positive skew* and a detached bar at the far right, indicating a *potential outlier* that may need to be addressed in our statistical tests.

- Both histograms are *unimodal* with the mode being around the *120-130 minute interval*.


```{r scatter-plot-side, echo=FALSE, fig.show="hold", out.width="50%", fig.cap="Scatter plots tracking daily commute durations for trips to campus (left) and return trips to home (right) over the observed period."}
par(mar = c(4, 4, 1, .1))

plot(bus_data$date, bus_data$dur_to_campus,
     main = "Commute Duration Over Time To Campus",
     xlab = "Date",
     ylab = "Duration (Minutes)",
     pch = 19,
     col = "lightblue",
     frame.plot = FALSE)

plot(bus_data$date, bus_data$dur_to_home,
     main = "Commute Duration Over Time To Home",
     xlab = "Date",
     ylab = "", # No Y label needed on 2nd plot
     pch = 19,
     col = "salmon",
     frame.plot = FALSE)
```

Plotting the commute durations over time (Figure \@ref(fig:scatter-plot-side)) highlights a stark contrast in stability between the two journeys:

- Trips to campus appear stable over time, showing only random noise without a noticeable increase or decrease in duration.

- Trips to home exhibit high variance, with widely dispersed data points, suggesting unpredictable delays that warrant further statistical testing.

```{r stacked-bar-side, echo=FALSE, fig.show="hold", fig.cap="Stacked bar chart showing the proportion of crowded UniLink buses to home during clear weather versus rain.", out.width="70%", fig.align="center"}
# 'Rain' on the X-axis and 'Crowded' stacked as the bars
counts <- table(bus_data$crowded_unilink_to_home, bus_data$rain_to_home)

# Rename the rows & cols for a cleaner plot text
colnames(counts) <- c("No Rain", "Rain")
rownames(counts) <- c("Not Crowded", "Crowded")

barplot(counts,
        main = "Bus Crowding vs. Weather Conditions",
        xlab = "Weather Condition",
        ylab = "Number of Trips",
        col = c("lightblue", "salmon"),
        legend = rownames(counts),
        args.legend = list(x = "topright", bty = "n"))

rm(counts)
```

An analysis of the interaction between weather and bus capacity (Figure \@ref(fig:stacked-bar-side)) suggests a strong correlation:

- **On clear days**, the distribution is balanced, with the bus being crowded roughly half the time.

- **On rainy days**, the vast majority of trips experience overcrowding, likely due to an increase in students choosing public transport over walking or cycling.

## Statistical Analysis Plan

While the exploratory analysis highlighted potential trends, such as the volatility of the evening commute and the correlation between rain and crowding, visual inspection alone is insufficient to draw firm conclusions. In this section, we define the specific hypotheses derived from our observations and outline the statistical methods selected to test them.

### Comparing Commute Directions (Paired t-test)

The scatter plot (Figure \@ref(fig:scatter-plot-side)) suggested that the journey home is not only more volatile but potentially longer on average than the morning commute. To confirm this, we analyse the difference in means between the two trips.

#### Method Justification:{.unnumbered}

Since each day (or record) consists of a trip to campus and a trip to home, a paired student t-test is the appropriate method to control for day-specific variance (e.g., a generally traffic-heavy day affecting both trips).

- $H_0$ (Null): There is no significant difference in mean duration between the trip to campus and the trip home ($\mu_{campus} = \mu_{home}$).

- $H_a$ (Alternative): The trip home takes significantly longer than the trip to campus ($\mu_{home} > \mu_{campus}$).

### Predictability of Arrival Times (Linear Regression)

We aim to understand the relationship between departure time and arrival time. Specifically, we want to assess if a linear model can accurately predict arrival times, or if traffic delays introduce non-linear variance.

#### Method Justification:{.unnumbered}

We use *Simple Linear Regression* to quantify the relationship between the independent variable (Departure) and the dependent variable (Arrival). Rather than a hypothesis test, the goal here is to assess the goodness of fit ($R^2$) to see how much of the variance in arrival time can be explained purely by the time of departure.

### The "Rain Effect" on Crowding (Fisher's Exact Test)

The bar chart (Figure \@ref(fig:stacked-bar-side)) indicated a strong dependency between rainy weather and bus overcrowding. We aim to calculate the statistical significance of this association.

#### Method Justification:{.unnumbered}

We are analyzing two categorical, binary variables (`rain_to_home` vs. `crowded_unilink_to_home`). This structure results in a $2 \times 2$ contingency table which Fisher’s Exact Test is well suited for.

- $H_0$ (Null): Weather conditions and bus crowding are independent.

- $H_a$ (Alternative): Rainy weather significantly increases the likelihood of the bus being crowded.

### Weekday Crowding Variance (Pearson's Chi-Square)

We investigate the specific phenomenon of the *"Thursday Rush."* Personal experience suggests that Thursdays are disproportionately crowded compared to other weekdays. This is probably because on Thursdays, I depart campus around 18:00 (6 PM), coinciding with the general close of business for local offices, while on other days I leave earlier.

#### Method Justification:{.unnumbered}

We examine the frequency of crowded buses across the distinct days of the week. Pearson’s Chi-square Test is chosen to determine if the distribution of crowded trips differs significantly from what we would expect by chance. Unlike Fisher's Exact Test (which we used for a $2 \times 2$ comparison), Chi-square is ideal for this $2 \times 4$ matrix (Crowded/Not Crowded vs. Mon/Wed/Thu/Fri).

### Conditional Probability of Events: Rain vs. Crowding (Bayes's Theorem)

While the previous tests determine if a relationship exists, we use Bayes's Theorem to quantify the dependency between the event **"It is Raining"** and the event **"The Bus is Crowded."** Specifically, we aim to measure how the presence of rain updates the probability of the bus being full.

#### Method Justification:{.unnumbered}

This is not a hypothesis test for statistical significance, but a Probability Update. We will calculate the **Prior Probability** ($P(Crowded)$), the baseline chance of a crowded bus on any random day, and compare it to the **Posterior Probability** ($P(Crowded | Rain)$).

- If $P(Crowded|Rain) = P(Crowded)$, the events are **Independent** (Rain has no effect).

- If $P(Crowded|Rain) > P(Crowded)$, the events are **Dependent**, and rain acts as a positive risk factor.

## Results and Interpretation

### Difference in Commute Durations

To determine if the journey home is statistically longer than the journey to campus, we perform a **paired t-test**. This controls for day-specific traffic conditions by comparing the two specific trips made on each date.

$$
\begin{aligned}
H_0 &: \mu_{home} = \mu_{campus} \\
H_a &: \mu_{home} > \mu_{campus}
\end{aligned}
$$

```{r paired-t-test, echo = TRUE, results = "hide"}
t_result <- t.test(bus_data$dur_to_home, bus_data$dur_to_campus,
                   paired = TRUE, alternative = "greater")
t_result
```

```{r display-t-test, echo=FALSE}
stats_table <- data.frame(
  "T_Statistic" = round(t_result$statistic, 2),
  "Degrees_of_Freedom"          = round(t_result$parameter, 0),
  "p_Value"     = format.pval(t_result$p.value, digits = 3),
  "Mean_Difference"   = paste(round(t_result$estimate, 1), "min")
)

knitr::kable(stats_table, align = "c", booktabs = TRUE) # Center align the columns
```


The test yields a **p-value of `r signif(t_result$p.value, 3)`**.

- **Decision:** Since the p-value is **greater** than the significant level ($\alpha = 0.05$), we **fail to reject** the null hypothesis.

- **Interpretation:** There is **insufficient** evidence to conclude that the trip back home takes significantly longer than the trip to campus.

### Predictability of Arrival Times

We use **Linear Regression** to assess how accurately the *departure time* predicts the *arrival time*.

$$
\begin{aligned}
H_0 &: \text{Slope} = 0 &\text{(Departure time does not predict arrival time)}\\
H_a &: \text{Slope} \neq 0 &\text{(There is a linear predicitive relationshop)}
\end{aligned}
$$

```{r prep-regression, echo = TRUE, results = "hide"}
# Combine the departure times and arrival times for campus and home trips
all_dep <- c(bus_data$dep_to_campus, bus_data$dep_to_home)
all_arr <- c(bus_data$arr_to_campus, bus_data$arr_to_home)

# Convert Strings to POSIXct (Date-Time objects)
# We use a dummy date so R sees them as times on the same timeline
dep_time <- as.POSIXct(all_dep, format="%I:%M:%S %p")
arr_time <- as.POSIXct(all_arr, format="%I:%M:%S %p")

# Calculate the Linear Model
fit <- lm(as.numeric(arr_time) ~ as.numeric(dep_time))
fit
```

```{r display-fit, echo=FALSE}
coefs <- summary(fit)$coefficients
rownames(coefs) <- c("Intercept (Unix Epoch)", "Departure Time")
knitr::kable(coefs, digits = 4, booktabs = TRUE)
rm(coefs)
```



We modeled the relationship using the linear equation:
$$
\text{Arrival} = A + B(\text{Departure}) + \epsilon
$$

Validating this model against the data reveals:

- **Decision:** Since the slope is not zero, we **reject the null hypothesis**. Arrival time is dependent on departure time.

- **Intercept ($A$):** Omitted since `POSIXct` data is stored as seconds since 1970. It holds no practical meaning for this daily commute analysis.

- **Slope ($B$):** The slope is `r round(coef(fit)[2], 3)`, indicating an almost 1-to-1 relationship. For every minute you leave later, you arrive approximately one minute later.

- **Error Margin ($\epsilon$):** The typical deviation from the predicted arrival time is `r round(summary(fit)$sigma / 60, 1)` minutes (Residual Standard Error).

- **Predictive Power ($R^2$):** The model explains `r round(summary(fit)$r.squared * 100, 1)`% of the variance in arrival times.


```{r linear-regression-side, echo=FALSE, fig.show="hold", out.width="50%", fig.cap="Regression analysis of commute times. The left panel displays all departure vs. all arrival times, colored by direction (Blue: To Campus, Pink: To Home). The right panel overlays the linear regression model (black line), indicating a strong predictive relationship."}
# Assign Colors based on Source
# First half is Campus (Light blue), Second half is Home (Salmon)
point_colors <- c(rep("lightblue", nrow(bus_data)), rep("salmon", nrow(bus_data)))

# Setup Split View
par(mar = c(4, 4, 1, .1))

# --- PLOT 1: Scatter Plot Only ---
plot(arr_time ~ dep_time,
     main = "Observed Commute Times",
     xlab = "Departure Time", ylab = "Arrival Time",
     pch = 19, col = point_colors,
     axes = FALSE) # Hide default axes

# Draw custom axes
axis.POSIXct(1, dep_time, format="%H:%M")
axis.POSIXct(2, arr_time, format="%H:%M", las=1)
box() # Adds box frame back around plot

# --- PLOT 2: With Regression Line ---
plot(arr_time ~ dep_time,
     main = "Linear Model Fit",
     xlab = "Departure Time", ylab = "", # No Y label needed on 2nd plot
     pch = 19, col = point_colors,
     axes = FALSE)

axis.POSIXct(1, dep_time, format="%H:%M")
axis.POSIXct(2, arr_time, format="%H:%M", las=1)
box()

# Add the regression line
abline(fit, col = "black", lwd = 2)
```


```{r delete-regression-variables, include=FALSE}
# Remove them to keep the environment clean
rm(all_dep, all_arr, dep_time, arr_time, point_colors)
```

### Impact of Rain on Crowding

We apply **Fisher's Exact Test** to determine if rainy weather significantly increases the odds of the UniLink bus being overcrowded. Fisher's test compares the Odds Ratio ($OR$). An odds ratio of 1 means the events are independent. Since we are testing if rain increases crowding, the alternative is "greater than 1."

$$
\begin{aligned}
H_0 &: OR = 1 &\text{(Rain and Crowding are independent)}\\
H_a &: OR > 1 &\text{(Rain increases the odds of Crowding)}
\end{aligned}
$$

```{r contingency-table, echo = TRUE, results = "hide"}
contingency_table <- table(bus_data$rain_to_home, bus_data$crowded_unilink_to_home)
rownames(contingency_table) <- c("Clear Weather", "Raining")
colnames(contingency_table) <- c("Not Crowded", "Crowded")
contingency_table
```

```{r display-contingency-table, echo=FALSE}
knitr::kable(contingency_table, booktabs = TRUE)
```


```{r fisher-test, echo = TRUE, results = "hide"}
fisher_result <- fisher.test(contingency_table, alternative = "greater")
fisher_result
```

```{r display-fisher-test, echo=FALSE}
fisher_stats <- data.frame(
  "Odds_Ratio" = round(fisher_result$estimate, 2),
  "p_Value"    = format.pval(fisher_result$p.value, digits = 3),
  row.names    = NULL # Removes row numbers for a cleaner look
)
knitr::kable(fisher_stats, booktabs = TRUE, align = "c")
```

- **Decision:** Since the p-value (`r fisher_stats$p_Value`) is less than 0.05, we **reject the null hypothesis**.

- **Interpretation:** The data indicates that rain significantly impacts commute comfort. The odds ratio suggests that a crowded bus is approximately **`r round(fisher_stats$Odds_Ratio, 1)` times** more likely to occur on a rainy day than on a clear day.

### Testing the "Thursday Rush": Weekday vs. Crowding

To investigate the "Thursday Rush," we perform a **Pearson’s Chi-square Test** to check if bus crowding is dependent on the specific day of the week.

$$
\begin{aligned}
H_0 &: p_{Mon} = p_{Wed} = p_{Thu} = p_{Fri} \text{ (Crowding rates are equal across all days)}\\
H_a &: \text{At least one day has a different crowding rate}
\end{aligned}
$$

```{r chi-table, echo = TRUE, results = "hide"}
# Order days logically (Mon-Fri), not alphabetically
days <- factor(
  bus_data$day_of_week,
  levels = c("Monday", "Wednesday", "Thursday", "Friday") # No Tuesday trips
  )
contingency_table_chi <- table(bus_data$crowded_unilink_to_home, days)
rownames(contingency_table_chi) <- c("Not Crowded", "Crowded")
contingency_table_chi
```

```{r display-chi-table, echo=FALSE}
knitr::kable(contingency_table_chi, booktabs = TRUE)
rm(days)
```

```{r chi-test, echo = TRUE, results = "hide"}
chi_result <- chisq.test(contingency_table_chi, simulate.p.value = TRUE)
chi_result
```

```{r display-chi-test, echo=FALSE}
chi_stats <- data.frame(
  "Chi_Square" = round(chi_result$statistic, 2),
  "p_Value"    = format.pval(chi_result$p.value, digits = 3),
  row.names    = NULL
)
knitr::kable(chi_stats, booktabs = TRUE, align = "c")
```

The analysis yields a p-value of `r signif(chi_result$p.value, 3)`, which is less than $0.05$.

- **Decision:** We **reject the null hypothesis**.

- **Interpretation:** There is significant evidence to support the claim that specific days are inherently more crowded.



